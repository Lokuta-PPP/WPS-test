name: æ¯æ—¥æ–°é—»æ¨é€åˆ°WPSåä½œ

on:
  schedule:
    # æ¯å¤©åŒ—äº¬æ—¶é—´ 9:00 å’Œ 18:00 æ¨é€ï¼ˆUTCæ—¶é—´éœ€å‡8å°æ—¶ï¼‰
    - cron: '0 1 * * *'   # UTC 01:00 = åŒ—äº¬æ—¶é—´ 09:00
    - cron: '0 10 * * *'  # UTC 10:00 = åŒ—äº¬æ—¶é—´ 18:00
  
  # å…è®¸æ‰‹åŠ¨è§¦å‘ï¼ˆæ–¹ä¾¿æµ‹è¯•ï¼‰
  workflow_dispatch:

jobs:
  send-news:
    runs-on: ubuntu-latest
    
    steps:
      # æ­¥éª¤1ï¼šæ£€å‡ºä»£ç ï¼ˆè™½ç„¶å¯èƒ½ç”¨ä¸åˆ°ï¼Œä½†æ˜¯æ ‡å‡†åšæ³•ï¼‰
      - name: Checkout code
        uses: actions/checkout@v4

      # æ­¥éª¤2ï¼šè·å–æ–°é—»å¹¶æ¨é€åˆ°WPS
      - name: è·å–æ–°é—»å¹¶æ¨é€
        env:
          WPS_KEY: ${{ secrets.WPS_WEBHOOK_KEY }}
        run: |
          # æ„å»ºWebhookå®Œæ•´URL
          WEBHOOK_URL="https://qyapi.wps.cn/cgi-bin/webhook/send?key=${WPS_KEY}"
          
          # è·å–å½“å‰æ—¥æœŸ
          TODAY=$(date +"%Yå¹´%mæœˆ%dæ—¥")
          
          # ===== æ–¹æ¡ˆAï¼šå›ºå®šæ¨¡æ¿æ–°é—»ï¼ˆæœ€ç®€å•ï¼Œé€‚åˆæµ‹è¯•ï¼‰=====
          MESSAGE="ğŸŒ… ${TODAY} æ—©é—´æ–°é—»ç®€æŠ¥
          

ğŸ’¡ è¯¦ç»†å†…å®¹è¯·å…³æ³¨å„å¤§æ–°é—»å¹³å°
â° æ›´æ–°æ—¶é—´ï¼š$(date +"%H:%M")"
          
          # å‘é€è¯·æ±‚
          curl -s "${WEBHOOK_URL}" \
            -H "Content-Type: application/json" \
            -d "{
              \"msgtype\": \"text\",
              \"text\": {
                \"content\": \"${MESSAGE}\"
              }
            }"
          
          echo "âœ… æ–°é—»æ¨é€å®Œæˆ"

      # æ­¥éª¤3ï¼šæ¨é€å›¾æ–‡æ¶ˆæ¯ï¼ˆæ›´ç¾è§‚ï¼Œå¯é€‰ï¼‰
      - name: æ¨é€å›¾æ–‡æ–°é—»ï¼ˆå¯é€‰ï¼‰
        env:
          WPS_KEY: ${{ secrets.WPS_WEBHOOK_KEY }}
        run: |
          WEBHOOK_URL="https://qyapi.wps.cn/cgi-bin/webhook/send?key=${WPS_KEY}"
          
          curl -s "${WEBHOOK_URL}" \
            -H "Content-Type: application/json" \
            -d '{
              "msgtype": "news",
              "news": {
                "articles": [
                  {
                    "title": "ğŸ“° æ¯æ—¥æ–°é—»ç®€æŠ¥ '$(date +"%mæœˆ%dæ—¥")'",
                    "description": "ä»Šæ—¥é‡ç‚¹æ–°é—»ä¸€é”®é€Ÿè§ˆï¼Œç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…...",
                    "url": "https://news.baidu.com",
                    "picurl": "https://picsum.photos/400/300"
                  }
                ]
              }
            }' || echo "å›¾æ–‡æ¨é€å¤±è´¥ï¼Œä½†ä¸å½±å“ä¸»æµç¨‹"
